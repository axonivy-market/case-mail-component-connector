<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<cc:interface componentType="IvyComponent">
	<cc:attribute name="id" required="true" />
</cc:interface>

<cc:implementation>
	<h:form id="form">
		<div class="flex justify-content-between">
			<div>
				<h2 style="margin: 0">Email details</h2>
			</div>
			<div class="flex justify-content-end mb-2">
				<p:commandButton id="newMailBtn"
					value="#{ivy.cms.co('/Button/newMail')}"
					update="@([id$=newEmailForm])"
					actionListener="#{mailBean.resetMail()}" icon="pi pi-envelope"
					oncomplete="PF('newEmailDialog').show()" />
			</div>
		</div>

		<!-- Mail list table -->
		<p:dataTable var="mail" value="#{mailBean.mailModel}"
			rowIndexVar="rowIndex" id="mailTable" paginator="true"
			paginatorPosition="bottom" rows="5"
			rowsPerPageTemplate="5,10,15,25,50,100" lazy="true"
			selectionMode="single" selection="#{mailBean.selectedMail}">
			<p:ajax event="rowSelect" update="@parent:viewMailComponent" />
			<p:column headerText="Created date" sortBy="#{mail.createdDate}"
				sortOrder="desc">
				<h:outputText value="#{mail.createdDate}" />
			</p:column>
			<p:column headerText="Status" sortBy="#{mail.status}">
				<h:outputText value="#{mail.status}" />
			</p:column>
			<p:column headerText="From" sortBy="#{mail.sender}">
				<h:outputText value="#{mail.sender}" />
			</p:column>
			<p:column headerText="To" sortBy="#{mail.recipient}">
				<h:outputText value="#{mail.recipient}" />
			</p:column>
			<p:column headerText="Subject" sortBy="#{mail.subject}">
				<h:outputText value="#{mail.subject}" />
			</p:column>
		</p:dataTable>

		<h:panelGroup id="viewMailComponent">
			<h:panelGroup rendered="#{not empty mailBean.selectedMail.id}">
				<!-- Actions -->
				<c:if test="#{mailBean.selectedMail.status ne 'SMTP_FAILED'}">
					<div class="flex mt-2">
						<p:commandButton id="replyEmail" process="@this"
							value="#{ivy.cms.co('/Button/reply')}"
							update="form @([id$=newEmailDialog])" icon="si si-arrow-left"
							actionListener="#{mailBean.prepareMail('REPLY')}"
							oncomplete="PF('newEmailDialog').show()" />

						<p:commandButton id="forwardEmail"
							value="#{ivy.cms.co('/Button/forward')}"
							update="form @([id$=newEmailDialog])" icon="si si-arrow-right"
							process="@this"
							actionListener="#{mailBean.prepareMail('FORWARD')}"
							oncomplete="PF('newEmailDialog').show()" />
						<p:commandButton id="resendEmail" process="@this"
							value="#{ivy.cms.co('/Button/resend')}"
							rendered="#{mailBean.isSent()}"
							update="form @([id$=newEmailDialog])" icon="si si-undo"
							oncomplete="PF('newEmailDialog').show()"
							actionListener="#{mailBean.prepareMail('RESEND')}">
							<p:confirm header="#{ivy.cms.co('/Labels/confirmation')}"
								message="#{mailBean.getConfirmMessage()}" escape="false"
								icon="si si-road-sign-warning" />
						</p:commandButton>
						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade"
							responsive="true" width="auto">
							<p:commandButton id="confirm-no-button"
								value="#{ivy.cms.co('/Button/no')}" type="button"
								styleClass="ui-confirmdialog-no ui-button-flat" />
							<p:commandButton id="confirm-yes-button"
								value="#{ivy.cms.co('/Button/yes')}" type="button"
								styleClass="ui-confirmdialog-yes" />
						</p:confirmDialog>
					</div>
				</c:if>

				<!-- Mail Details -->
				<p:fieldset id="mailDetail" legend="Mail Details" toggleable="true"
					toggleSpeed="500" style="margin-top:1.5rem">
					<h:panelGrid columns="1" style="width:100%;">
						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="subject"
								value="#{ivy.cms.co('/Mail/subject')}" />
							<p:inputText id="subject"
								value="#{mailBean.selectedMail.subject}" readonly="true" />
						</h:panelGroup>
					</h:panelGrid>

					<h:panelGrid columns="2" style="width:100%;"
						columnClasses="value,value">
						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="from" value="#{ivy.cms.co('/Mail/from')}" />
							<p:inputText id="from" value="#{mailBean.selectedMail.sender}"
								readonly="true" style="width:100%" />
						</h:panelGroup>

						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="to" value="#{ivy.cms.co('/Mail/to')}" />
							<p:inputText id="to" value="#{mailBean.selectedMail.recipient}"
								readonly="true" style="width:100%" />
						</h:panelGroup>

						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="cc" value="#{ivy.cms.co('/Mail/cc')}" />
							<p:inputText id="cc" value="#{mailBean.selectedMail.recipientCC}"
								readonly="true" style="width:100%" />
						</h:panelGroup>

						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="sent" value="#{ivy.cms.co('/Mail/sent')}" />
							<p:inputText id="sent" value="#{mailBean.selectedMail.sentDate}"
								readonly="true" style="width:100%" />
						</h:panelGroup>

					</h:panelGrid>
					<h:panelGrid columns="1" style="width:100%;">
						<h:panelGroup layout="block" style="width:100%">
							<h:outputLabel for="attachments"
								value="#{ivy.cms.co('/Mail/attachments')}" />
							<p:inputText id="attachments" value="" readonly="true" />
						</h:panelGroup>
					</h:panelGrid>
				</p:fieldset>
			</h:panelGroup>
		</h:panelGroup>

		<!-- Mail Dialog -->
		<ic:com.axonivy.connector.mail.NewMailDialog id="newMail"
			mail="#{mailBean.mail}" mailBrowserId="#{cc.attrs.id}" />
	</h:form>
</cc:implementation>

</html>
